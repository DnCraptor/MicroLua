#include "mlua/file.h"

__asm__(
    "  .section .rodata\n"
    "  .balign 4\n"
    "start:\n"
    "  .incbin \"@PATH@\"\n"
    "  .balign 1\n"
    "end:\n"
    // Lua seems to rely on a terminating zero byte when laoding chunks in text
    // mode, even if it isn't included in the chunk size. This is likely a bug.
    "  .byte 0\n"
);

extern const char start[];
extern const char end[];

static mlua_file file = {.path = "@NAME@", .start = start, .end = end};

static __attribute__((constructor)) void add_file(void) {
    mlua_add_file(&file);
}
